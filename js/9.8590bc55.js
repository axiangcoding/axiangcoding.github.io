(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"1f68":function(e,t,a){"use strict";var s=a("9309"),n=a.n(s);n.a},9309:function(e,t,a){},9938:function(e,t,a){"use strict";var s=a("bae6"),n=a.n(s);n.a},bae6:function(e,t,a){},de29:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"row"},[a("q-space"),a("q-card",{staticClass:"my-card q-my-md"},[a("q-card-section",{staticClass:"bg-primary text-white"},[a("div",{staticClass:"text-h6"},[e._v("站内消息")])]),a("q-card-section",{staticClass:"q-gutter-sm row items-center"},[a("div",{staticClass:"q-gutter-x-sm"},[a("q-radio",{attrs:{"keep-color":"",val:"",label:"全部",color:"primary"},model:{value:e.filter.status,callback:function(t){e.$set(e.filter,"status",t)},expression:"filter.status"}}),a("q-radio",{attrs:{"keep-color":"",val:"0",label:"未读",color:"negative"},model:{value:e.filter.status,callback:function(t){e.$set(e.filter,"status",t)},expression:"filter.status"}}),a("q-radio",{attrs:{"keep-color":"",val:"2",label:"标记",color:"orange"},model:{value:e.filter.status,callback:function(t){e.$set(e.filter,"status",t)},expression:"filter.status"}})],1),a("q-input",{staticClass:"q-mr-md",attrs:{standout:"",dense:"",label:"查询发送人",placeholder:"输入发送人用户名"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filter.fromUsername,callback:function(t){e.$set(e.filter,"fromUsername",t)},expression:"filter.fromUsername"}}),a("q-input",{staticClass:"q-mr-md",attrs:{standout:"",dense:"",label:"查询标题",placeholder:"输入标题，支持模糊查询"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filter.title,callback:function(t){e.$set(e.filter,"title",t)},expression:"filter.title"}}),a("q-btn",{staticClass:"q-mr-md",attrs:{color:"primary",round:"",icon:"search"},on:{click:function(t){return e.getMessage()}}}),a("q-btn",{attrs:{color:"negative",round:"",icon:"clear_all"},on:{click:function(t){return e.cleanFilter()}}},[a("q-tooltip",[e._v("重置筛选")])],1),a("q-separator",{staticClass:"q-mx-lg",attrs:{vertical:""}}),a("q-btn",{attrs:{color:"positive"},on:{click:function(t){return e.doAllRead()}}},[e._v("全部已读")]),a("q-btn",{attrs:{color:"negative"},on:{click:function(t){return e.doDeleteAll()}}},[e._v("全部删除")])],1),a("q-card-section",[a("el-pagination",{attrs:{layout:"sizes, prev, pager, next, jumper","current-page":e.pagination.currentPage,"page-size":e.pagination.pageSize,total:e.pagination.totalRows},on:{"size-change":e.sizeChange,"current-change":e.switchPage}}),a("el-table",{attrs:{data:e.data}},[a("el-table-column",{attrs:{label:"#",prop:"id","min-width":"10%"}}),a("el-table-column",{attrs:{label:"状态","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return["已读"===t.row.status?a("q-chip",{attrs:{color:"positive","text-color":"white"}},[e._v(e._s(t.row.status))]):"未读"===t.row.status?a("q-chip",{attrs:{color:"negative","text-color":"white"}},[e._v(e._s(t.row.status))]):"已标记"===t.row.status?a("q-chip",{attrs:{color:"orange","text-color":"white",icon:"star"}},[e._v(e._s(t.row.status))]):e._e()]}}])}),a("el-table-column",{attrs:{prop:"time",label:"时间","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.formatDate(t.row.time)))]}}])}),a("el-table-column",{attrs:{prop:"fromUsername",label:"发送人","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return["SYSTEM"===t.row.fromUsername?a("q-chip",{attrs:{color:"primary","text-color":"white"}},[e._v("系统")]):"admin"===t.row.fromUsername?a("q-chip",{attrs:{color:"amber-9","text-color":"white"}},[e._v("管理员")]):a("q-btn",{attrs:{"no-caps":"",dense:"",flat:"",color:"secondary"}},[e._v(e._s(t.row.fromUsername))])]}}])}),a("el-table-column",{attrs:{prop:"title",label:"标题","min-width":"40%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("q-btn",{attrs:{"no-caps":"",dense:"",flat:"",color:"primary"},on:{click:function(a){return e.showMessage(t.row.id)}}},[e._v(e._s(t.row.title))])]}}])}),a("el-table-column",{attrs:{label:"操作","min-width":"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return["已标记"!==t.row.status?a("div",{staticClass:"q-gutter-x-md"},[a("q-btn",{attrs:{color:"negative"},on:{click:function(a){return e.doDelete(t.row.id)}}},[e._v("删除")]),a("q-btn",{attrs:{color:"orange"},on:{click:function(a){return e.setStatus(t.row.id,2)}}},[e._v("标记信息")])],1):a("div",[e._v("\n              取消标记为：\n              "),a("q-btn",{staticClass:"q-mr-sm",attrs:{color:"positive"},on:{click:function(a){return e.setStatus(t.row.id,1)}}},[e._v("已读")]),a("q-btn",{attrs:{color:"negative"},on:{click:function(a){return e.setStatus(t.row.id,0)}}},[e._v("未读")])],1)]}}])})],1),a("div",{staticClass:"row"},[a("q-space"),a("el-pagination",{staticClass:"col-auto",attrs:{layout:"prev, pager, next, jumper","current-page":e.pagination.currentPage,"page-size":e.pagination.pageSize,total:e.pagination.totalRows},on:{"size-change":e.sizeChange,"current-change":e.switchPage}})],1),a("q-inner-loading",{attrs:{showing:e.loading}},[a("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1)],1),a("q-space")],1)},n=[],r=a("967e"),o=a.n(r),i=(a("96cf"),a("fa84")),c=a.n(i),l=a("bd4c"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-dialog",{ref:"dialog",on:{hide:e.onDialogHide}},[a("q-card",{staticClass:"dialog-card q-my-md"},[a("q-card-section",{staticClass:"bg-secondary text-white"},[a("div",{staticClass:"text-h5 q-mb-sm"},[e._v("\n        #"+e._s(e.id)+" "+e._s(e.msgInfo.title)+"\n        "),1===e.msgInfo.status?a("q-chip",{attrs:{color:"positive","text-color":"white"}},[e._v("已读")]):0===e.msgInfo.status?a("q-chip",{attrs:{color:"negative","text-color":"white"}},[e._v("未读")]):2===e.msgInfo.status?a("q-chip",{attrs:{color:"orange","text-color":"white",icon:"star"}},[e._v("已标记")]):e._e()],1),a("div",{staticClass:"justify-center"},[e._v("\n        来自：\n        "),"SYSTEM"===e.msgInfo.fromUsername?a("q-chip",{attrs:{color:"primary","text-color":"white"}},[e._v("系统")]):"admin"===e.msgInfo.fromUsername?a("q-chip",{attrs:{color:"amber-9","text-color":"white"}},[e._v("管理员")]):a("q-btn",{attrs:{outline:""}},[e._v(e._s(e.msgInfo.fromUsername))])],1)]),a("q-card-section",[a("div",{staticClass:"text-h6",domProps:{innerHTML:e._s(e.msgInfo.text)}})]),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{color:"primary",disable:"SYSTEM"===e.msgInfo.fromUsername,label:"回复"},on:{click:function(t){return e.onOKClick()}}}),a("q-btn",{attrs:{color:"negative",label:"关闭"},on:{click:function(t){return e.onCancelClick()}}})],1)],1)],1)},p=[],d=(a("c5f6"),{props:{id:Number},data:function(){return{msgInfo:""}},mounted:function(){this.getMessage()},methods:{getMessage:function(){var e=this;return c()(o.a.mark((function t(){var a,s;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=new URLSearchParams,a.append("username",e.$store.getters["global/getUsername"]),a.append("messageId",e.id),t.next=5,e.$axios.post("/user/message/info",a);case 5:s=t.sent,e.msgInfo=s.datas[0],0===e.msgInfo.status&&e.setMessage();case 8:case"end":return t.stop()}}),t)})))()},setMessage:function(){var e=this;return c()(o.a.mark((function t(){var a;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=new URLSearchParams,a.append("username",e.$store.getters["global/getUsername"]),a.append("messageId",e.id),a.append("status",1),t.next=6,e.$axios.post("/user/message/setStatus",a);case 6:t.sent;case 7:case"end":return t.stop()}}),t)})))()},show:function(){this.$refs.dialog.show()},hide:function(){this.$refs.dialog.hide()},onDialogHide:function(){this.$emit("hide")},onOKClick:function(){this.$router.push({name:"replayMessage"}),this.$emit("ok"),this.hide()},onCancelClick:function(){this.hide()}}}),g=d,m=(a("9938"),a("2877")),f=a("eebe"),h=a.n(f),v=a("24e8"),w=a("f09f"),q=a("a370"),b=a("b047"),x=a("9c40"),_=a("4b7e"),k=Object(m["a"])(g,u,p,!1,null,"1a10d4ec",null),S=k.exports;h()(k,"components",{QDialog:v["a"],QCard:w["a"],QCardSection:q["a"],QChip:b["a"],QBtn:x["a"],QCardActions:_["a"]});var $={data:function(){return{loading:!1,filter:{fromUsername:"",status:"",title:""},pagination:{currentPage:1,pageSize:10,totalRows:0},data:[]}},mounted:function(){this.getMessage()},methods:{formatDate:function(e){return l["a"].formatDate(e,"YYYY-MM-DD HH:mm:ss")},cleanFilter:function(){this.filter.fromUsername="",this.filter.status="",this.filter.title=""},switchPage:function(e){this.pagination.currentPage=e,this.getMessage()},sizeChange:function(e){this.pagination.pageSize=e,this.getMessage()},getMessage:function(){var e=this;return c()(o.a.mark((function t(){var a,s;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,a=new URLSearchParams,a.append("pageNum",e.pagination.currentPage),a.append("pageSize",e.pagination.pageSize),a.append("username",e.$store.getters["global/getUsername"]),a.append("fromUsername",e.filter.fromUsername),a.append("status",e.filter.status),a.append("title",e.filter.title),t.next=10,e.$axios.post("/user/message/list",a).catch((function(){e.loading=!1}));case 10:s=t.sent,e.data=s.datas[0],e.pagination.totalRows=s.datas[1],e.loading=!1;case 14:case"end":return t.stop()}}),t)})))()},setStatus:function(e,t){var a=this;return c()(o.a.mark((function s(){var n,r,i;return o.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return n=0===t?"未读":1===t?"已读":"已标记",r=new URLSearchParams,r.append("username",a.$store.getters["global/getUsername"]),r.append("messageId",e),r.append("status",t),s.next=7,a.$axios.post("/user/message/setStatus",r);case 7:i=s.sent,1e4===i.code&&(a.$q.notify({message:"设置成功！",caption:"# ".concat(e," 的消息已被设置为 ").concat(n),color:"positive",icon:"done"}),a.getMessage());case 9:case"end":return s.stop()}}),s)})))()},setAllRead:function(){var e=this;return c()(o.a.mark((function t(){var a,s;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=new URLSearchParams,a.append("username",e.$store.getters["global/getUsername"]),a.append("status",1),t.next=5,e.$axios.post("/user/message/setStatus/all",a);case 5:s=t.sent,1e4===s.code&&(0!==s.datas[0]?(e.$q.notify({message:"设置成功！",caption:"共 ".concat(s.datas[0]," 条消息已被设置为已读"),color:"positive",icon:"done"}),e.getMessage()):e.$q.notify({message:"已完成",caption:"全部消息均已读",color:"warning",icon:"done"}));case 7:case"end":return t.stop()}}),t)})))()},deleteMsg:function(e){var t=this;return c()(o.a.mark((function a(){var s,n;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=new URLSearchParams,s.append("username",t.$store.getters["global/getUsername"]),s.append("messageId",e),a.next=5,t.$axios.post("/user/message/delete",s);case 5:n=a.sent,1e4===n.code&&(t.$q.notify({message:"删除成功！",caption:"# ".concat(e," 的消息已被删除"),color:"positive",icon:"done"}),t.getMessage());case 7:case"end":return a.stop()}}),a)})))()},deleteAll:function(){var e=this;return c()(o.a.mark((function t(){var a,s;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=new URLSearchParams,a.append("username",e.$store.getters["global/getUsername"]),t.next=4,e.$axios.post("/user/message/delete/all",a);case 4:s=t.sent,1e4===s.code&&(0!==s.datas[0]?(e.$q.notify({message:"删除成功！",caption:"共 ".concat(s.datas[0]," 条未标记的消息已删除"),color:"positive",icon:"done"}),e.getMessage()):e.$q.notify({message:"已完成",caption:"全部未标记的消息已删除",color:"warning",icon:"done"}));case 6:case"end":return t.stop()}}),t)})))()},showMessage:function(e){var t=this;this.$q.dialog({component:S,parent:this,id:e}).onDismiss((function(){t.getMessage()}))},doDelete:function(e){var t=this;this.$q.dialog({title:"警告",message:"您即将把 #".concat(e," 的消息删除，该操作不可逆，请确认"),ok:{push:!0,color:"negative",label:"确认删除"},cancel:{push:!0}}).onOk((function(){t.deleteMsg(e)}))},doAllRead:function(){var e=this;this.$q.dialog({title:"警告",message:"设置全部未读消息为已读，可能会让你错过重要信息，请确认",ok:{push:!0,color:"positive",label:"全部已读"},cancel:{push:!0}}).onOk((function(){e.setAllRead()}))},doDeleteAll:function(){var e=this;this.$q.dialog({title:"警告",message:"将删除所有未标记的消息，全部删除后不可恢复，请确认",ok:{push:!0,color:"negative",label:"全部删除"},cancel:{push:!0}}).onOk((function(){e.deleteAll()}))}}},C=$,y=(a("1f68"),a("99899")),U=a("2c91"),M=a("3786"),I=a("27f9"),Q=a("0016"),P=a("05c0"),R=a("eb85"),z=a("74f7"),D=a("cf57"),A=Object(m["a"])(C,s,n,!1,null,"6d7ee776",null);t["default"]=A.exports;h()(A,"components",{QPage:y["a"],QSpace:U["a"],QCard:w["a"],QCardSection:q["a"],QRadio:M["a"],QInput:I["a"],QIcon:Q["a"],QBtn:x["a"],QTooltip:P["a"],QSeparator:R["a"],QChip:b["a"],QInnerLoading:z["a"],QSpinnerGears:D["a"]})}}]);